<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="../bootstrap.4.6.2.css">
		<style>
            html{
                user-select: none;
            }
            .outgame{
                display: block;
                text-align: center;
                padding: 100px 0;
            }
            #game{
                background-color:antiquewhite;
                padding: 20px;
                position: relative;
                border-radius: 20px;
            }
            #popup, #popup2{
                background-color: rgba(255, 255, 255, 0.795);
                width: 80%;
                height: 80%;
                position: absolute;
                left: 10%;
                top: 10%;
                border-radius: 30px;
                justify-content: center;
                z-index: 1;
                align-content: center;
            }
            div{
                display: inline-block;
                line-height: 0;
                transition: 0.2s;
                margin: auto;
            }
			.box{
                width: 80px;
                height: 80px;
                transform: scale(0.8);
                border-radius: 10px;
            }
            .vertLine{
                width: 10px;
                height: 80px;
            }
            .horLine{
                width: 80px;
                height: 10px;
            }
            .vertLine:hover, .horLine:hover{
                background-color: lightgrey;
                cursor: pointer;
            }
            .dot{
                width: 10px;
                height: 10px;
                background-color: black;
                border-radius: 30px;
                transform: scale(2);
            }
            hr{
                margin: -11px;
                opacity: 0;
            }
            h3{
                width: 100%;
            }
            input, button{
                margin: auto 10px;
            }
            .player{
                padding: 20px;
                background-color: rgba(214, 214, 214, 0.795);
                border-radius: 20px;
            }
            .start{
                position: absolute;
                right: 0;
                top: 45%;
                border-radius: 50px;
            }
            .row{
                gap: 40px;
                transform: scale(0.8);
            }
            #points{
                position: absolute;
                left: 0;
                background-color: antiquewhite;
                padding: 20px;
                border-top-right-radius: 20px;
                border-bottom-right-radius: 20px;
                transition: 0.5s;
                h4{
                    display: inline-block;
                }
            }
		</style>
	</head>
	<body>
		<div class="outgame">
            <h4 id="turn"> Turn: Player 1</h4>
            <button class="btn btn-dark btn-lg float-right" onclick="reset()">Reset</button>
            <div id="points"></div>
            <div id="game">
                <div id="board"></div>
                <div id="popup">
                    <div class="form-inline mt-5 mb-2 justify-content-center">
                        <input id="width" style="width: 30%;" type="number" class="form-control" placeholder="Board width" min="3" max="30" value="10">
                        <input id="height" style="width: 30%;" type="number" class="form-control" placeholder="Board height" min="3" max="30" value="6">
                        <button onclick="size()" class="btn btn-dark">Enter</button>
                    </div>
                    <div class="form-inline mt-5 mb-2 justify-content-center">
                        <input id="pCount" style="width: 50%;" type="number" class="form-control" placeholder="Number of players" min="2" max="6" value="2">
                        <button onclick="colors()" class="btn btn-dark">Enter</button>
                    </div>
                    <div id="colors" class="row"></div>
                    <button class="btn btn-dark start" onclick="start()">Start -></button>
                </div>
                <div id="popup2">
                    <h2 id="winner">a</h2>
                    <button class="btn btn-dark" onclick="reset()">Reset</button>
                </div>
            </div>
        </div>
    <script>
        let game = document.getElementById('board');
        let h = 6;
        let w = 10;
        let div = document.createElement('div');
        let players = [];
        let chance = 0;

        function make(){
            game.innerHTML += '<br>';
            div.classList.add('dot');
            game.appendChild(div);

            for(j = 0; j < w * 2; j++){
                let div = document.createElement('div');
                if (j % 2 == 0){
                    div.classList.add('horLine');
                }
                else{
                    div.classList.add('dot');
                }
                game.appendChild(div);
            }
            game.innerHTML += '<br>';

            for(i = 0; i < h; i++){
                let div = document.createElement('div');
                div.classList.add('vertLine');
                game.appendChild(div);
                for(j = 0; j < w * 2; j++){
                    let div = document.createElement('div');
                    if (j % 2 == 0){
                        div.classList.add('box');
                    }
                    else{;
                        div.classList.add('vertLine');
                    }
                    game.appendChild(div);
                }
                div = document.createElement('div');
                game.innerHTML += '<br>';
                div.classList.add('dot');
                game.appendChild(div);

                for(j = 0; j < w * 2; j++){
                    let div = document.createElement('div');
                    if (j % 2 == 0){
                        div.classList.add('horLine');
                    }
                    else{
                        div.classList.add('dot');
                    }
                    game.appendChild(div);
                }
                game.innerHTML += '<br>';
            }
        }
        make();

        function size(){
            game.innerHTML = '';
            w = document.getElementById('width').value;
            h = document.getElementById('height').value;
            make();
            colors();
            click();
        }

        function reset(){
            game.innerHTML = '';
            w = document.getElementById('width').value;
            h = document.getElementById('height').value;
            make();
            colors();
            click();
            let popup = document.getElementById('popup');
            popup.style.transform = 'scale(1)'
        }

        function player(){
            let turn = document.getElementById('turn');
            playerlen = players.length;
            chance++;
            if(chance >= playerlen){
                chance = 0;
            }
            turn.innerHTML = `Turn: Player ${chance + 1}`;
            turn.style.color = players[chance];
        }

        let playerColor = document.getElementById('colors');
        function colors(){
            inp = document.getElementById('pCount').value;
            playerColor.innerHTML = '';
            for(i = 0; i < inp; i++){
                playerColor.innerHTML += '<div class="col-3 player"><form class="form-inline text-left"><h3>Player ' + (i + 1) +'</h3><h4>Color: </h4><input style="width: 60px;" type="color" class="form-control"></form>';
            }
        }
        colors();

        function start(){
            players = [];
            let len = playerColor.children.length;
            let popup = document.getElementById('popup');
            document.getElementById('points').innerHTML = '';
            for(i = 0; i < len; i++){
                players[i] = playerColor.children[i].children[0].children[2].value;
                console.log(players[i]);
            }
            popup.style.transform = 'scale(0)';
            points();
            turn.style.color = players[chance];

        }

        let box = document.getElementsByClassName('box');
        let vertline = document.getElementsByClassName('vertLine');
        let horline = document.getElementsByClassName('horLine');

        function click(){
            for(i=0;i<vertline.length;i++){
                vertline[i].addEventListener("click", function (){clickLine(this)});
            }
            for(i=0;i<horline.length;i++){
                horline[i].addEventListener("click", function (){clickLine(this)});
            }
        }
        click();

        bool = false;
        function clickLine(elem){
            let pointNum = document.getElementsByClassName('pointNumber');
            if(elem.style.backgroundColor == ''){
                elem.style.backgroundColor = players[chance];
                elem.style.cursor = 'default';
                boxCheck(players[chance]);
                if(bool == false){
                    player();
                }
                else{
                    pointNum[chance].innerHTML = parseInt(pointNum[chance].innerHTML) + 1;
                }
                bool = false;
            }
        }
        let inc = 0;
        function boxCheck(color){
            for(i = 0; i < box.length; i++){
                if(i % parseInt(w) == 0 && i != 0){
                    inc++;
                }
                if(vertline[i + inc].style.backgroundColor != '' && vertline[i + 1 + inc].style.backgroundColor != '' &&horline[i].style.backgroundColor != '' && horline[i + parseInt(w)].style.backgroundColor != '' && box[i].style.backgroundColor == ''){
                    box[i].style.backgroundColor = color;
                    bool = true;
                }
            }
            inc = 0;
            winCheck();
        }

        function points(){
            let points = document.getElementById('points');
            for(i = 0; i < players.length; i++){
                points.innerHTML += '<div><h4 style="color:'+players[i]+'">Player ' + (i + 1) + ':&nbsp;</h4><h4 style="color:'+players[i]+'" class="pointNumber">0</h4></div><br>'
            }
        }

        let popup2 = document.getElementById('popup2');
        popup2.style.transform = 'scale(0)';
        function winCheck(){
            let win = false;
            for(i = 0; i < box.length; i++){
                if(box[i].style.backgroundColor == ''){
                    win = false;
                    break;
                }
                else{
                    win = true;
                }
            }
            if(win == true){
                let pointNum = document.getElementsByClassName('pointNumber');
                let winner = document.getElementById('winner');
                let won = 0;
                let pos;
                for(i = 0; i < pointNum.length; i++){
                    if(won <= parseInt(pointNum[i].innerHTML)){
                        won = parseInt(pointNum[i].innerHTML);
                        pos = i
                        console.log(i)
                    }
                    else{
                        won = 0;
                    }
                }
                console.log(pos);
                winner.innerHTML = 'Winner: ' + pointNum[pos].parentElement.children[0].innerHTML.split('').slice(0,-7).join('');
                popup2.style.transform = 'scale(1)';
            }
        }
    </script>
    </body>
</html>